<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="Business Card Design Tool">
  <meta name="author" content="Ahmed YILMAZ">
  <title>Business Card Generator</title>
  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/fabric.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery-ui.min.js"></script>
  <script src="js/FileSaver.min.js"></script>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia">
  <link href='https://fonts.googleapis.com/css?family=Aclonica' rel='stylesheet'>
  <link href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Notable&display=swap" rel="stylesheet">


  <!-- FONTS SOURCE :: https://fonts.google.com/?selection.family=Pangolin&sidebar.open#standard-styles -->

  <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">

  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/my_style.css" rel="stylesheet">
</head>

<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
          aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Eric text</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
      </div>
      <!--/.nav-collapse -->
    </div>
  </nav>


  <div class="row text-center">
    <div id="toolbox" class="btn-group-horizontal btn-group-lg" role="group" aria-label="...">
      <button id="add-text" type="button" class="btn btn-default">
        <i class="fa fa-font" aria-hidden="true" title="Add text"></i>
      </button>
      <button id="clear" type="button" class="btn btn-default">
        <i class="fa fa-trash-o" aria-hidden="true" title="Clear canvas"></i>
      </button>
      <!-- <button id="save" type="button" class="btn btn-default">
        <i class="fa fa-floppy-o" aria-hidden="true" title="Save"></i>
      </button> -->
      <button id="download" type="button" class="btn btn-default">
        <i class="fa fa-download" aria-hidden="true" title="Save as image"></i>
      </button>
    </div>
  </div>


  <div class="row">
    <!-- Left panel -->
    <div class="col-md-2">
      <!-- <div id="toolbox" class="btn-group-vertical btn-group-lg" role="group" aria-label="...">
        <button id="add-text" type="button" class="btn btn-default">
          <i class="fa fa-font" aria-hidden="true" title="Add text"></i>
        </button>
        <button id="clear" type="button" class="btn btn-default">
          <i class="fa fa-trash-o" aria-hidden="true" title="Clear canvas"></i>
        </button>
        <button id="save" type="button" class="btn btn-default">
          <i class="fa fa-floppy-o" aria-hidden="true" title="Save"></i>
        </button>
        <button id="download" type="button" class="btn btn-default">
          <i class="fa fa-download" aria-hidden="true" title="Save as image"></i>
        </button>
      </div> -->

      <!-- experiment -->
      <div id="main-box-size" class="panel panel-default">
        <div class="panel-body">
          <h4 style="color:grey">Main Box Size</h4>
          <div class="input-group">
            <span class="input-group-addon" id="basic-addon1">Width:</span>
            <input id="main-box-width" type="number" class="form-control" value="" aria-describedby="basic-addon1">
          </div>
          <div class="input-group">
            <span class="input-group-addon" id="basic-addon1">Height:</span>
            <input id="main-box-height" type="number" class="form-control" value="" aria-describedby="basic-addon1">
          </div>
        </div>
      </div>


      <div id="properties" class="panel panel-default">
        <div class="panel-body">
          <h4 style="color:grey">Properties</h4>
          <div class="input-group" style="display:none;">
            <span class="input-group-addon" id="basic-addon1">Font:</span>
            <select class="form-control" id="text-font">
              <option>Helvetica</option>
              <option>Pangolin</option>
              <option>Aclonica</option>
              <option>Notable</option>
            </select>
          </div>

          <div class="input-group" style="display:none;">
            <span class="input-group-addon" id="basic-addon1">Font Size:</span>
            <input id="text-fontsize" type="number" class="form-control" value="" aria-describedby="basic-addon1">
          </div>

          <div class="input-group" style="display:none;">
            <span class="input-group-addon" id="basic-addon1">Font Weight:</span>
            <select class="form-control" id="text-fontweight">
              <option selected>normal</option>
              <option>bold</option>
            </select>
          </div>
          <div class="input-group">
            <span class="input-group-addon" id="basic-addon1">Width:</span>
            <input id="width" type="number" class="form-control" value="" aria-describedby="basic-addon1">
          </div>
          <div class="input-group">
            <span class="input-group-addon" id="basic-addon1">Height:</span>
            <input id="height" type="number" class="form-control" value="" aria-describedby="basic-addon1">
          </div>
          <div class="input-group">
            <span class="input-group-addon" id="basic-addon1">Angle:</span>
            <input id="angle" type="number" class="form-control" value="" aria-describedby="basic-addon1">
          </div>
          <div class="input-group">
            <span class="input-group-addon" id="basic-addon1">Color:</span>
            <input id="color" type="color" class="form-control" value="" aria-describedby="basic-addon1">
          </div>
          <!-- <div class="input-group">
            <span class="input-group-addon" id="basic-addon1">Opacity:</span>
            <input id="opacity" type="number" class="form-control" value="" aria-describedby="basic-addon1">
          </div> -->
        </div>
      </div>
      <!--end of properties panel-->

      <div id="layers" class="panel panel-default">
        <div class="panel-body">
          <h4 style="color:grey">Layers</h4>

          <ul class="background">
            <li onclick="deneme();">
              <div class="panel panel-default">
                <div class="layer panel-body">
                  Background
                  <button id="canvas-props" type="button" class="btn btn-default">
                    <i class="fa fa-cog" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </li>
          </ul>
          <ul id="sortable">
            <!-- Magic happens here-->
          </ul>
        </div>
      </div>
      <!-- EX{ERIMENT} -->
    </div>
    <!-- End Left panel -->

    <!-- Middle canvas -->
    <div class="col-md-10">
      <div class="canvas">
        <canvas id=canvas style="overflow-x: scroll;" width=" 900" height="500"></canvas>

        <script type="text/javascript">
          var canvas = new fabric.Canvas("canvas", { backgroundColor: '#FFFFFF' });
        </script>
      </div>
    </div>

    <!-- End Middle canvas -->
  </div>


  <script type="text/javascript">
    const PRICE = 1;

    // window.onbeforeunload = function() {
    //   return "Data will be lost if you leave the page, are you sure?";
    // };

    $(function () {
      $("#sortable").sortable();
      $("#sortable").disableSelection();
    });

    var edit_canvas = 0;

    var global_id = 1;
    canvas.uniScaleTransform = true;
    canvas.renderAll();

    canvas.on('object:selected', onObjectSelected);

    var selected_obj = new fabric.Object();

    function onObjectSelected(e) {
      onSelectionCleared();
      selected_obj = e.target;
      selectLayer(selected_obj.get('id'));

      if (selected_obj.get('type') == 'i-text') {
        document.getElementById('text-font').parentNode.style.display = "table";
        document.getElementById('text-font').value = e.target.get('fontFamily');
        document.getElementById('text-fontsize').parentNode.style.display = "table";
        document.getElementById('text-fontsize').value = e.target.get('fontSize');
        document.getElementById('text-fontweight').parentNode.style.display = "table";
        document.getElementById('text-fontweight').value = e.target.get('fontWeight');
        document.getElementById('color').value = e.target.get('fill') //rgb2hex(e.target.get('fill'));
        document.getElementById('color').parentNode.style.display = "table";
      }
      else if (selected_obj.get('type') == 'image') {
        document.getElementById('color').parentNode.style.display = "none";
      }
      else {
        document.getElementById('color').value = e.target.get('fill');
        document.getElementById('color').parentNode.style.display = "table";
      }
      document.getElementById('width').value = Math.round(e.target.get('width') * e.target.get('scaleX'));
      document.getElementById('height').value = Math.round(e.target.get('height') * e.target.get('scaleY'));
      document.getElementById('angle').value = Math.round(e.target.get('angle'));
      // document.getElementById('opacity').value = e.target.get('opacity');

    }

    canvas.on('selection:cleared', onSelectionCleared);

    function onSelectionCleared() {

      document.getElementById('text-font').parentNode.style.display = "none";
      document.getElementById('text-fontsize').parentNode.style.display = "none";
      document.getElementById('text-fontweight').parentNode.style.display = "none";
      document.getElementById('color').parentNode.style.display = "table";
      document.getElementById('color').value = "";
      document.getElementById('width').parentNode.style.display = "table";
      document.getElementById('width').value = "";
      document.getElementById('height').parentNode.style.display = "table";
      document.getElementById('height').value = "";
      document.getElementById('angle').parentNode.style.display = "table";
      document.getElementById('angle').value = "";
      // document.getElementById('opacity').parentNode.style.display = "table";
      // document.getElementById('opacity').value = "";

      var layeritems = document.getElementsByClassName("layeritem");
      for (var i = 0; i < layeritems.length; i++) {
        layeritems[i].childNodes[0].style.backgroundColor = "#fff";
      }

      selected_obj = null;
      edit_canvas = 0;
    }

    canvas.on('text:changed', function (e) {
      console.log('text:changed', e.target, e);
      //console.log(JSON.stringify(e.target))
      textMetrics = document.getElementById('canvas').getContext('2d').measureText(e.target.text)
      console.log("WIDTH: " + textMetrics.width)
      console.log("ACTUAL: " + (Math.abs(textMetrics.actualBoundingBoxLeft) + Math.abs(textMetrics.actualBoundingBoxRight)));
      console.log(e.target.fontSize)
      //console.table(e.target)

      console.log("KKKKKKKK")
      var all_objects = canvas.getObjects();
      console.log(Array.from(all_objects, x => x.text));
    });


    // const canvass = document.getElementById('canvas');
    // const ctx = canvass.getContext('2d');
    // const text = 'Abcdefghgvjhbijklmnop';
    // ctx.font = 'italic 50px serif';
    // const textMetrics = ctx.measureText(text);

    // console.log(textMetrics.width);
    // // 459.8833312988281

    // console.log(Math.abs(textMetrics.actualBoundingBoxLeft) +
    //   Math.abs(textMetrics.actualBoundingBoxRight));
    // // 462.8833333333333



    canvas.on('object:scaling', onObjectScaled);

    function onObjectScaled(e) {
      //alert("scaled")
      console.log("scalex" + e.target.get('scaleX'))
      console.log("scaleY" + e.target.get('scaleY'))
      console.log()
      console.log(document.getElementById('canvas').getContext('2d').measureText("sdfsa"))

      document.getElementById('width').value = Math.round(e.target.get('width') * e.target.get('scaleX'));
      document.getElementById('height').value = Math.round(e.target.get('height') * e.target.get('scaleY'));
      document.getElementById('angle').value = Math.round(parseInt(e.target.get('angle')));
      canvas.renderAll();
    }

    canvas.on('object:rotating', onObjectRotated);

    function onObjectRotated(e) {
      document.getElementById('angle').value = e.target.get('angle');
      canvas.renderAll();
    }

    canvas.on('object:added', onObjectAdded);
    function onObjectAdded(e) {
      //Doesn't work :(
      selected_obj = searchObjById(e.target.get('id'));
      canvas.setActiveObject(selected_obj);
      canvas.renderAll();
    }

    // This gets and sets the font family
    $('#text-font').on('input', function () {
      if (selected_obj != null) {
        selected_obj.set("fontFamily", $(this).val());
        canvas.renderAll();
      }
    });

    $('#text-fontsize').on('keydown', function () {
      if (event.which == 13 || event.keyCode == 13) {
        if (selected_obj != null) {
          selected_obj.set("fontSize", parseInt($(this).val()));
          canvas.renderAll();
        }
      }
    });
    $('#text-fontsize').on('blur', function () {
      if (selected_obj == canvas.getActiveObject()) {
        if (selected_obj != null) {
          document.getElementById('text-fontsize').value = selected_obj.get('fontSize');
        }
      }
    });

    $('#text-fontweight').on('input', function () {
      if (selected_obj != null) {
        selected_obj.set("fontWeight", $(this).val());
        canvas.renderAll();
      }
    });


    // MAIN BOX
    $('#main-box-width').on('keydown', function () {
      if (event.which == 13 || event.keyCode == 13) {
        if (selected_obj != null) {
          // change the width of the main outer box
          canvas.setWidth(Math.round(parseInt($(this).val())));
          canvas.renderAll();
        }
      }
    });


    $('#main-box-height').on('keydown', function () {
      if (event.which == 13 || event.keyCode == 13) {
        if (selected_obj != null) {
          // change the width of the main outer box
          canvas.setHeight(Math.round(parseInt($(this).val())));
          canvas.renderAll();
        }
      }
    });

    // HERE
    $('#width').on('keydown', function () {
      if (event.which == 13 || event.keyCode == 13) {
        if (selected_obj != null) {
          if (selected_obj.get('type') === 'i-text') {
            selected_obj.set("width", Math.round(parseInt($(this).val())));
            canvas.renderAll();
          }
        }
      }
    });
    // HERE




    $('#width').on('blur', function () {
      if (selected_obj == canvas.getActiveObject() && selected_obj != null) {
        document.getElementById('width').value = Math.round(selected_obj.get('width') * selected_obj.get('scaleX'));
      } else {
        document.getElementById('width').value = "";
      }
    });


    $('#height').on('keydown', function () {
      if (event.which == 13 || event.keyCode == 13) {
        if (selected_obj != null) {
          if (selected_obj.get('type') === 'i-text') {
            selected_obj.set("height", Math.round(parseInt($(this).val())));
            canvas.renderAll();
          }
        }
      }
    });

    $('#height').on('blur', function () {
      if (selected_obj == canvas.getActiveObject() && selected_obj != null) {
        document.getElementById('height').value = Math.round(selected_obj.get('height') * selected_obj.get('scaleY'));
      } else {
        document.getElementById('height').value = "";
      }
    });

    $('#angle').on('keydown', function () {
      if (event.which == 13 || event.keyCode == 13) {
        if (selected_obj != null) {
          selected_obj.setAngle(Math.round(parseInt($(this).val())));
          canvas.renderAll();
        }
      }
    });

    $('#angle').on('blur', function () {

      if (selected_obj == canvas.getActiveObject() && selected_obj != null) {
        document.getElementById('angle').value = Math.round(selected_obj.get('angle'));
      } else {
        document.getElementById('angle').value = "";
      }
    });

    $('#color').on('change', function () {
      selected_obj.setColor(event.target.value)
    });

    // $('#color').on('keydown', function () {

    //   if (event.which == 13 || event.keyCode == 13) {
    //     if (edit_canvas == 1) {
    //       canvas.backgroundColor = $(this).val();
    //     } else {
    //       if (selected_obj != null) {
    //         selected_obj.setColor($(this).val());
    //       }
    //     }
    //     canvas.renderAll();
    //   }
    // });

    // $('#color').on('blur', function () {
    //   if (selected_obj == canvas.getActiveObject() && selected_obj != null) {
    //     if (selected_obj.get('type') == 'i-text') {
    //       alert("here")
    //       document.getElementById('color').value = rgb2hex(selected_obj.get('fill'));
    //     } else {
    //       alert("here")
    //       document.getElementById('color').value = selected_obj.get('fill');
    //     }
    //   } else if (edit_canvas == 0) {
    //     document.getElementById('color').value = "";
    //   }
    // });

    // $('#opacity').on('keydown', function () {
    //   console.log("opacity1")
    //   if (event.which == 13 || event.keyCode == 13) {
    //     if (selected_obj != null) {
    //       selected_obj.set({
    //         opacity: $(this).val()
    //       });
    //       canvas.renderAll();
    //     }
    //   }
    // });
    // $('#opacity').on('blur', function () {
    //   if (selected_obj == canvas.getActiveObject() && selected_obj != null) {
    //     document.getElementById('opacity').value = selected_obj.get('opacity');
    //   } else {
    //     document.getElementById('opacity').value = "";
    //   }
    // });
    //Adding Objects

    var canvas_items = [];//This array holds objects' ids added to canvas, ordered by z index.

    //Toolbox

    $("#add-text").click(function () {

      var text = new fabric.IText('NEW: Click to edit text...', {
        left: 100,
        top: 100,
        fontFamily: "Helvetica",
        fontSize: 18,
        id: global_id
      });
      canvas.add(text);
      onSelectionCleared();
      canvas.renderAll();
      canvas.discardActiveObject();
      selected_obj = text;
      add_layer(global_id);
      global_id++;
    });

    $("#clear").click(function () {
      var buttons = document.getElementsByClassName("delete-layer");
      var count = buttons.length;
      for (var i = 0; i < count; i++) {
        buttons[0].parentNode.parentNode.parentNode.remove();
      }
      global_id = 1;
      canvas.clear();
      canvas.backgroundColor = "#FFFFFF";
      onSelectionCleared();
      canvas.renderAll();

    });


    // Download item as a BCD
    // $("#save").click(function () {

    //   var jsonObj = canvas.toJSON(['id']);

    //   var layersArr = [];
    //   var layeritems = document.getElementsByClassName("layeritem");
    //   for (var i = 0; i < layeritems.length; i++) {
    //     layersArr.push({
    //       layertitle: layeritems[i].childNodes[0].childNodes[0].childNodes[0].textContent,
    //       id: layeritems[i].getAttribute('id')
    //     });
    //   }
    //   jsonObj.Layers = layersArr;

    //   var json = JSON.stringify(jsonObj);
    //   var blob = new Blob([json], { type: "application/json" });
    //   var url = URL.createObjectURL(blob);

    //   var a = document.createElement('a');
    //   a.download = "my-business-card.bcd";
    //   a.href = url;
    //   a.click();

    // });

    $("#load-bcd").click(function () {
      $("#upload-bcd").click();
    });

    function onChange(event) {
      var reader = new FileReader();
      reader.onload = onReaderLoad;
      reader.readAsText(event.target.files[0]);
    }


    function onReaderLoad(event) {
      var obj = JSON.parse(event.target.result);
      $("#upload-bcd")[0].value = "";
      $("#clear").click();

      global_id = 1;
      for (var i = 0; i < obj.Layers.length; i++) {
        add_layer(obj.Layers[i].id, true);
        if (global_id <= obj.Layers[i].id) {
          global_id = obj.Layers[i].id;
        }
      }
      global_id++;
      delete obj.Layers;

      canvas.loadFromJSON(obj);
      canvas.renderAll();

    }


    $("#download").click(function () {
      canvas.discardActiveObject();
      canvas.renderAll();
      $("#canvas").get(0).toBlob(function (blob) {
        saveAs(blob, "my-text.png");
      });
    });

    //Layer Operations

    $("#canvas-props").click(function () {
      canvas.discardActiveObject();
      canvas.renderAll();
      edit_canvas = 1;

      document.getElementById('text-font').parentNode.style.display = "none";
      document.getElementById('text-fontsize').parentNode.style.display = "none";
      document.getElementById('width').parentNode.style.display = "none";
      document.getElementById('height').parentNode.style.display = "none";
      document.getElementById('angle').parentNode.style.display = "none";
      document.getElementById('opacity').parentNode.style.display = "none";

      document.getElementById('color').value = canvas.backgroundColor;

    });


    function add_layer(id, loading) {

      var li = document.createElement("LI");
      li.setAttribute('id', id);
      li.setAttribute('class', 'layeritem');
      var div = document.createElement("DIV");
      div.setAttribute('class', 'panel panel-default');
      var innerdiv = document.createElement("DIV");
      innerdiv.setAttribute('class', 'layer panel-body');
      var layer_name = document.createTextNode("Layer " + id);
      var span = document.createElement("SPAN");
      span.setAttribute('for', 'layer' + id);
      span.setAttribute('class', 'clickMe');
      var input = document.createElement("INPUT");
      input.setAttribute('type', 'text');
      input.setAttribute('value', '');
      input.setAttribute('id', 'layer' + id);
      input.setAttribute('class', 'blur');
      input.style.display = "none";
      var delete_btn = document.createElement("BUTTON");
      delete_btn.setAttribute('id', id);
      delete_btn.setAttribute('type', 'button');
      delete_btn.setAttribute('class', 'delete-layer btn btn-default');
      var i = document.createElement("I");
      i.setAttribute('class', 'fa fa-trash');
      i.setAttribute('aria-hidden', 'true');

      delete_btn.appendChild(i);
      span.appendChild(layer_name);
      innerdiv.appendChild(span);
      innerdiv.appendChild(input);
      innerdiv.appendChild(delete_btn);
      div.appendChild(innerdiv);
      li.appendChild(div);
      if (loading == true) {
        document.getElementById('sortable').appendChild(li);
      } else {
        document.getElementById('sortable').insertBefore(li, document.getElementById('sortable').firstChild);
      }

      $('.clickMe').click(function () {
        "use strict";
        $(this).hide();
        $('#' + $(this).attr('for'))
          .val($(this).text())
          .toggleClass("form-control")
          .show()
          .focus();
      });

      $('.blur').blur(function () {
        "use strict";
        $(this)
          .hide()
          .toggleClass("form-control");
        $('span[for=' + (this).id + ']')
          .text($(this).val())
          .show();
      });

      var layeritems = document.getElementsByClassName("layeritem");
      for (var i = 0; i < layeritems.length; i++) {
        layeritems[i].onclick = function () {
          selected_obj = searchObjById(this.id);
          selectLayer(selected_obj.get('id'));
          canvas.setActiveObject(selected_obj);
          canvas.renderAll();
        };
      }

      var buttons = document.getElementsByClassName("delete-layer");
      for (var i = 0; i < buttons.length; i++) {
        buttons[i].onclick = function () {
          this.parentNode.parentNode.parentNode.remove();
          canvas.remove(searchObjById(this.id));
          canvas.renderAll();
        };
      }
    }

    function searchObjById(id) {
      var objs = canvas.getObjects();
      for (var i = 0; i < objs.length; i++) {
        if (objs[i].get('id') == id) {
          return objs[i];
        }
      }
    }

    //Delete layer through keyboard
    $('html').keyup(function (e) {
      if (e.keyCode == 46) {
        if (canvas.getActiveObject().get('type') != 'i-text') {
          var buttons = document.getElementsByClassName("delete-layer");
          for (var i = 0; i < buttons.length; i++) {
            if (buttons[i].getAttribute("id") == canvas.getActiveObject().get('id')) {
              buttons[i].parentNode.parentNode.parentNode.remove();
            }
          }
          canvas.remove(canvas.getActiveObject());
        }
      }
    });

    //Layer Sort Z-index
    $(document).ready(function () {
      $("#sortable").sortable({
        stop: function (event, ui) {
          canvas_items = $("#sortable").sortable('toArray', { attribute: "id" });
          canvas_items.reverse();
          for (var i = 0; i < canvas_items.length; i++) {
            canvas.moveTo(searchObjById(canvas_items[i]), i + 1);
          }
        }
      });
    });


    // Selected objects layer gets highlighted -  highlight selected layer
    function selectLayer(id) {
      var layeritems = document.getElementsByClassName("layeritem");
      for (var i = 0; i < layeritems.length; i++) {
        if (id == layeritems[i].getAttribute('id')) {
          layeritems[i].childNodes[0].style.backgroundColor = "#d1f542"; // #eee
        }
      }
    }

    //RGB to HEX
    function rgb2hex(rgb) {
      rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
      return (rgb && rgb.length === 4) ? "#" +
        ("0" + parseInt(rgb[1], 10).toString(16)).slice(-2) +
        ("0" + parseInt(rgb[2], 10).toString(16)).slice(-2) +
        ("0" + parseInt(rgb[3], 10).toString(16)).slice(-2) : '';
    }


    /*
        function loadTemplate(template) {
          var linesandshapes = { "objects": [{ "type": "rect", "originX": "left", "originY": "top", "left": -46.75, "top": 359.62, "width": 8, "height": 200, "fill": "#43D785", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1, "scaleY": 1, "angle": -45, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "rx": 0, "ry": 0, "id": 7 }, { "type": "rect", "originX": "left", "originY": "top", "left": -28.42, "top": 317.94, "width": 8, "height": 250, "fill": "#43D785", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1, "scaleY": 1, "angle": -45, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "rx": 0, "ry": 0, "id": 6 }, { "type": "rect", "originX": "left", "originY": "top", "left": -9.1, "top": 274.26, "width": 8, "height": 300, "fill": "#43D785", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1, "scaleY": 1, "angle": -45, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "rx": 0, "ry": 0, "id": 5 }, { "type": "rect", "originX": "left", "originY": "top", "left": 17.37, "top": 237.5, "width": 8, "height": 400, "fill": "#43D785", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1, "scaleY": 1, "angle": -45, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "rx": 0, "ry": 0, "id": 4 }, { "type": "rect", "originX": "left", "originY": "top", "left": 53.25, "top": 207.62, "width": 8, "height": 400, "fill": "#43D785", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1, "scaleY": 1, "angle": -45, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "rx": 0, "ry": 0, "id": 3 }, { "type": "triangle", "originX": "left", "originY": "top", "left": 623.14, "top": -85.98, "width": 300, "height": 150, "fill": "#43D785", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1, "scaleY": 1, "angle": 45, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "id": 1 }, { "type": "i-text", "originX": "left", "originY": "top", "left": 481.02, "top": 258, "width": 214.89, "height": 40.68, "fill": "rgb(0,0,0)", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1.11, "scaleY": 1.01, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "text": "H A I R  S A L O N", "fontSize": 36, "fontWeight": "normal", "fontFamily": "Impact", "fontStyle": "normal", "lineHeight": 1.16, "underline": false, "overline": false, "linethrough": false, "textAlign": "left", "textBackgroundColor": "", "charSpacing": 0, "id": 9, "styles": {} }, { "type": "i-text", "originX": "left", "originY": "top", "left": 386.02, "top": 40, "width": 272.72, "height": 170.86, "fill": "rgb(0,0,0)", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1.23, "scaleY": 1.22, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "text": "L I N E S  &\nS H A P E S", "fontSize": 70, "fontWeight": "normal", "fontFamily": "Impact", "fontStyle": "normal", "lineHeight": 1.16, "underline": false, "overline": false, "linethrough": false, "textAlign": "left", "textBackgroundColor": "", "charSpacing": 0, "id": 8, "styles": {} }, { "type": "triangle", "originX": "left", "originY": "top", "left": -148.34, "top": 138.21, "width": 400, "height": 200, "fill": "#000", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1, "scaleY": 1, "angle": -45, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "id": 2 }], "background": "#FFFFFF", "Layers": [{ "layertitle": "Black Triangle", "id": "2" }, { "layertitle": "Lines & Shapes", "id": "8" }, { "layertitle": "Hair Salon", "id": "9" }, { "layertitle": "Green Triangle", "id": "1" }, { "layertitle": "Layer 3", "id": "3" }, { "layertitle": "Layer 4", "id": "4" }, { "layertitle": "Layer 5", "id": "5" }, { "layertitle": "Layer 6", "id": "6" }, { "layertitle": "Layer 7", "id": "7" }] };
    
          var lacquer = { "objects": [{ "type": "rect", "originX": "left", "originY": "top", "left": -240.49, "top": 127.05, "width": 200, "height": 200, "fill": "#FFA7AF", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 4.87, "scaleY": 1.98, "angle": 330, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "rx": 0, "ry": 0, "id": 1 }, { "type": "rect", "originX": "left", "originY": "top", "left": -40.79, "top": 465.71, "width": 900, "height": 200, "fill": "#C1FCF7", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 2.82, "scaleY": 1.89, "angle": 330, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "rx": 0, "ry": 0, "id": 2 }, { "type": "rect", "originX": "left", "originY": "top", "left": 154.02, "top": 109, "width": 200, "height": 200, "fill": "#FFFFFF", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 2.11, "scaleY": 1.22, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "rx": 0, "ry": 0, "id": 3 }, { "type": "i-text", "originX": "left", "originY": "top", "left": 268, "top": 190, "width": 215.36, "height": 67.8, "fill": "#FFA7AF", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1, "scaleY": 1, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "text": "Lacquer", "fontSize": 60, "fontWeight": "normal", "fontFamily": "Georgia", "fontStyle": "normal", "lineHeight": 1.16, "underline": false, "overline": false, "linethrough": false, "textAlign": "left", "textBackgroundColor": "", "charSpacing": 0, "id": 7, "styles": {} }, { "type": "i-text", "originX": "left", "originY": "top", "left": 338.02, "top": 156, "width": 61.13, "height": 22.6, "fill": "#121212", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1.18, "scaleY": 1, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "text": "N A I L", "fontSize": 20, "fontWeight": "normal", "fontFamily": "Helvetica", "fontStyle": "normal", "lineHeight": 1.16, "underline": false, "overline": false, "linethrough": false, "textAlign": "left", "textBackgroundColor": "", "charSpacing": 0, "id": 8, "styles": {} }, { "type": "i-text", "originX": "left", "originY": "top", "left": 326, "top": 286, "width": 90.03, "height": 22.6, "fill": "#121212", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1.14, "scaleY": 1, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "text": "S A L O N", "fontSize": 20, "fontWeight": "normal", "fontFamily": "Helvetica", "fontStyle": "normal", "lineHeight": 1.16, "underline": false, "overline": false, "linethrough": false, "textAlign": "left", "textBackgroundColor": "", "charSpacing": 0, "id": 9, "styles": {} }], "background": "#FFFFFF", "Layers": [{ "layertitle": "Layer 9", "id": "9" }, { "layertitle": "Layer 8", "id": "8" }, { "layertitle": "Layer 7", "id": "7" }, { "layertitle": "Layer 3", "id": "3" }, { "layertitle": "Layer 2", "id": "2" }, { "layertitle": "Layer 1", "id": "1" }] };
    
          var lilysmith = { "objects": [{ "type": "rect", "originX": "left", "originY": "top", "left": 365.02, "top": 58, "width": 320, "height": 320, "fill": "#F7C8C4", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1.03, "scaleY": 1, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "rx": 0, "ry": 0, "id": 1 }, { "type": "i-text", "originX": "left", "originY": "top", "left": 169, "top": 111, "width": 298.04, "height": 219.67, "fill": "#333333", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 0.91, "scaleY": 0.84, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "text": "LILY\nSMITH", "fontSize": 90, "fontWeight": "normal", "fontFamily": "Georgia", "fontStyle": "normal", "lineHeight": 1.16, "underline": false, "overline": false, "linethrough": false, "textAlign": "left", "textBackgroundColor": "", "charSpacing": 0, "id": 2, "styles": {} }, { "type": "i-text", "originX": "left", "originY": "top", "left": 173, "top": 310, "width": 160.85, "height": 27.12, "fill": "#333333", "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "strokeLineCap": "butt", "strokeLineJoin": "miter", "strokeMiterLimit": 10, "scaleX": 1.06, "scaleY": 1, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "shadow": null, "visible": true, "clipTo": null, "backgroundColor": "", "fillRule": "nonzero", "globalCompositeOperation": "source-over", "transformMatrix": null, "skewX": 0, "skewY": 0, "text": "makeup artist", "fontSize": 24, "fontWeight": "normal", "fontFamily": "Lucida Sans Unicode", "fontStyle": "normal", "lineHeight": 1.16, "underline": false, "overline": false, "linethrough": false, "textAlign": "left", "textBackgroundColor": "", "charSpacing": 0, "id": 3, "styles": {} }], "background": "#FFFFFF", "Layers": [{ "layertitle": "Layer 3", "id": "3" }, { "layertitle": "Layer 2", "id": "2" }, { "layertitle": "Layer 1", "id": "1" }] };
    
          var obj = "";
          switch (template) {
            case 'linesandshapes':
              obj = linesandshapes;
              break;
            case 'lacquer':
              obj = lacquer;
              break;
            case 'lilysmith':
              obj = lilysmith;
              break;
    
          }
          $("#clear").click();
    
          global_id = 1;
          for (var i = 0; i < obj.Layers.length; i++) {
            add_layer(obj.Layers[i].id, true);
            if (global_id <= obj.Layers[i].id) {
              global_id = obj.Layers[i].id;
            }
          }
          global_id++;
          delete obj.Layers;
    
          canvas.loadFromJSON(obj);
          canvas.renderAll();
          obj = "";
    
        }
    */


    var myCanvas = document.getElementById("canvas");
    if (myCanvas.addEventListener) {
      myCanvas.addEventListener("mousedown", drag, false);
    } else if (myCanvas.attachEvent) {
      myCanvas.attachEvent("onmousedown", drag);
    } else {
      myCanvas.setAttribute("onmousedown", drag);
    }

    function drag(e) {
      var mousePosition = [0, 0];
      if (!e) var e = window.event;
      var dragObj = e.target ? e.target : e.srcElement;

      if (e.button == 0 || e.button == 1) {
        if (window.attachEvent) {
          mousePosition[0] = e.offsetX;
          mousePosition[1] = e.offsetY;
          e.returnValue = false;
        } else {
          mousePosition[0] = e.offsetX || e.layerX;
          mousePosition[1] = e.offsetY || e.layerY;
          e.preventDefault();
        }

        document.body.onmousemove = function (e) {
          if (!e) var e = window.event;
          dragObj.style.left = e.clientX - mousePosition[0] + "px";
          dragObj.style.top = e.clientY - mousePosition[1] + "px";
        }

        document.onmouseup = function () {
          document.body.onmousemove = null;
          document.body.onselectstart = null;
        }
      }
    }

  </script>
</body>

</html>